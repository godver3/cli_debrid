{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<style>
    .stats-box.recently-added {
        grid-column: 1 / -1;
        margin-bottom: 20px;
    }

    .stats-box.recently-added ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }

    .stats-box.recently-added li {
        margin-bottom: 10px;
        color: #FFA500;
    }

    .stats-box.recently-added .added-date {
        display: inline-block;
        margin-left: 5px;
        font-style: italic;
        color: #f4f4f4;
    }

    .card-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .card {
        width: 200px;
        border: 1px solid #555;
        border-radius: 8px;
        overflow: hidden;
        background-color: #444;
    }

    .card-img {
        width: 100%;
        height: 300px;
        object-fit: cover;
    }

    .card-content {
        padding: 10px;
    }

    .card h5 {
        margin: 0 0 5px 0;
        font-size: 1em;
        color: #f4f4f4;
    }

    .card .added-date {
        font-size: 0.8em;
        color: #bbb;
    }
</style>

<div class="stats-container">

    <div class="stats-box recently-aired">
        <h3>Recently Aired</h3>
        {% if stats.recently_aired %}
            <ul>
            {% for item in stats.recently_aired %}
                <li style="color: #FFA500;">
                    {{ item.title }} S{{ '%02d'|format(item.season) }}E{{ '%02d'|format(item.episode) }} - 
                    <span class="air-date" style="color: #f4f4f4;">
                        {% if item.air_datetime.date() == stats.today %}
                            Today
                        {% elif item.air_datetime.date() == stats.yesterday %}
                            Yesterday
                        {% else %}
                            {{ item.air_datetime.strftime('%Y-%m-%d') }}
                        {% endif %}
                    </span>
                    <span class="air-time" style="color: #f4f4f4;">at {{ item.air_datetime.strftime('%H:%M') }}</span>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>No shows aired recently.</p>
        {% endif %}
    </div>

    <div class="stats-box airing-soon">
        <h3>Airing Soon</h3>
        {% if stats.airing_soon %}
            <ul>
            {% for item in stats.airing_soon %}
                <li style="color: #FFA500;">
                    {{ item.title }} S{{ '%02d'|format(item.season) }}E{{ '%02d'|format(item.episode) }} - 
                    <span class="air-date" style="color: #f4f4f4;">
                        {% if item.air_datetime.date() == stats.today %}
                            Today
                        {% elif item.air_datetime.date() == stats.tomorrow %}
                            Tomorrow
                        {% else %}
                            {{ item.air_datetime.strftime('%Y-%m-%d') }}
                        {% endif %}
                    </span>
                    <span class="air-time" style="color: #f4f4f4;">at {{ item.air_datetime.strftime('%H:%M') }}</span>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>No shows airing soon.</p>
        {% endif %}
    </div>

    <div class="stats-box upcoming-releases">
        <h3>Upcoming Releases</h3>
        {% if stats.upcoming_releases %}
            <ul>
            {% for item in stats.upcoming_releases %}
                <li style="color: #FFA500;">
                    {{ item.titles|join(', ') }} - 
                    <span class="release-date" style="color: #f4f4f4;">
                        {% if item.release_date == stats.today %}
                            Today
                        {% elif item.release_date == stats.tomorrow %}
                            Tomorrow
                        {% else %}
                            {{ item.release_date }}
                        {% endif %}
                    </span>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>No upcoming releases in the next week.</p>
        {% endif %}
    </div>

    <div class="stats-box recently-added">
        <h3>Recently Added</h3>
        <div class="recently-added-section">
            <h4>Movies</h4>
            {% if stats.recently_added_movies %}
                <div class="card-container">
                {% for movie in stats.recently_added_movies %}
                    <div class="card">
                        {% if movie.poster_url %}
                            <img src="{{ movie.poster_url }}" alt="{{ movie.title }} poster" class="card-img">
                        {% endif %}
                        <div class="card-content">
                            <h5>{{ movie.title }} {% if movie.year %}({{ movie.year }}){% endif %}</h5>
                            <p class="added-date">{{ movie.added_at }}</p>
                        </div>
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <p>No movies added recently.</p>
            {% endif %}
        </div>
        <div class="recently-added-section">
            <h4>TV Shows</h4>
            {% if stats.recently_added_shows %}
                <div class="card-container">
                {% for show in stats.recently_added_shows %}
                    <div class="card">
                        {% if show.poster_url %}
                            <img src="{{ show.poster_url }}" alt="{{ show.title }} poster" class="card-img">
                        {% endif %}
                        <div class="card-content">
                            <h5>{{ show.title }}</h5>
                            <p class="added-date">Added: {{ show.added_at }}</p>
                            <p class="seasons">Seasons: {{ show.seasons|join(', ') }}</p>
                        </div>
                    </div>
                {% endfor %}
                </div>
            {% else %}
                <p>No TV shows added recently.</p>
            {% endif %}
        </div>
    </div>

    <div class="stats-box collection-stats">
        <h3>Collection Statistics</h3>
        <div class="stat-items">
            <div class="stat-item">
                <p>Total Movies: <span id="total-movies">{{ stats.total_movies }}</span></p>
            </div>
            <div class="stat-item">
                <p>Total TV Shows: <span id="total-shows">{{ stats.total_shows }}</span></p>
            </div>
            <div class="stat-item">
                <p>Total Episodes: <span id="total-episodes">{{ stats.total_episodes }}</span></p>
            </div>
            <div class="stat-item uptime">
                <p>Uptime: <span id="uptime">{{ '%d days, %d hours, %d minutes' % (stats.uptime // 86400, (stats.uptime % 86400) // 3600, (stats.uptime % 3600) // 60) }}</span></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}