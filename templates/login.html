{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/inline.css') }}">
{% endblock %}
{% block title %}Login{% endblock %}
{% block content %}
{% if posters %}
<div class="background-posters">
    {% for poster in posters %}
    <img src="{{ poster.url }}" class="floating-poster" onerror="this.style.display='none';" style="{{ poster.style }}">
    {% endfor %}
</div>
{% endif %}
<div class="auth-form">
    <h2>Login</h2>
    <form method="POST">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>
        <div class="remember-me">
            <input type="checkbox" name="remember_me" id="remember_me">
            <label for="remember_me">Remember me</label>
        </div>
        <input type="submit" value="Login">
    </form>
    {% if show_login_reminder %}
    <p class="login-reminder">{{ login_reminder_message }}</p>
    {% endif %}
</div>
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages-container">
        {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
        {% endfor %}
        </div>
        {% set has_error = false %}
        {% for category, message in messages %}
            {% if category == 'error' and not has_error %}
                {% if 'login' in message.lower() or 'check' in message.lower() or 'invalid' in message.lower() %}
                    {% set has_error = true %}
                    <div class="reset-reminder">
                        <p><strong>Need to reset admin account?</strong></p>
                        <p>Run <code>./reset_admin.sh</code> to reset credentials to admin/admin</p>
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
    {% endif %}
{% endwith %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var flashMessages = document.querySelectorAll('.flash-message');
        if (flashMessages.length > 0) {
            flashMessages.forEach(function(flashMessage) {
                setTimeout(function() {
                    flashMessage.classList.add('show');
                }, 100);

                // Don't auto-hide login failure messages
                var messageText = flashMessage.textContent.toLowerCase();
                if (!messageText.includes('please check your login details')) {
                    setTimeout(function() {
                        flashMessage.classList.remove('show');
                    }, 5000);
                }
            });
        }

        var rememberMeCheckbox = document.getElementById('remember_me');
        if (rememberMeCheckbox) {
            if (localStorage.getItem('rememberMe') === 'true') {
                rememberMeCheckbox.checked = true;
            }

            rememberMeCheckbox.addEventListener('change', function() {
                localStorage.setItem('rememberMe', this.checked);
            });
        }
    });
</script>

{% endblock %}
