{% extends "base.html" %}
{% block title %}Add Media{% endblock %}
{% block head %}
<style>
    /* Prevent white flash on page load */
    html {
        background-color: #0a0a0a !important;
    }
    body {
        background: linear-gradient(to bottom, #333 0px, #333 450px, #000 650px) !important;
    }
</style>
{% endblock %}
{% block content %}
<meta name="theme-color" content="#333333">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet" href="{{ url_for('static', filename='css/scraper.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/scraper_trending.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/scraper-mobile.css') }}">
<div id="scraper-container" class="{% if not tmdb_api_key_set %}no-tmdb-api{% endif %}">

        
        <form id="search-form" onsubmit="return false;">
            <input type="hidden" id="tmdb_api_key_set" value="{{ 'True' if tmdb_api_key_set else 'False' }}">
            <input type="hidden" id="is_requester" value="{{ 'True' if is_requester else 'False' }}">
            <input type="text" name="search_term" placeholder="Enter search term" required>
            <select name="version" id="version-select">
                {% for version in versions %}
                    <option value="{{ version }}">{{ version }}</option>
                {% endfor %}
                <option value="No Version">No Version</option>
            </select>
            <div class="checkbox-container specials-checkbox">
                <input type="checkbox" id="allow-specials" name="allow_specials">
                <label for="allow-specials" style="color: #ccc; font-size: 0.9em;">Allow Specials</label>
            </div>
            <div id="skip-cache-check-container" class="checkbox-container" style="display: inline-block; margin-left: 10px; vertical-align: middle;">
                <input type="checkbox" id="skip-cache-check" name="skip_cache_check">
                <label for="skip-cache-check" style="color: #ccc; font-size: 0.9em;">Skip Cache Check</label>
            </div>
            <button id="searchformButton" type="submit">Search</button>
            <!-- Back Button (Desktop Only) -->
            <div id="back-button-container" class="back-button-container" style="display: none;">
                <button id="back-button" class="back-button" aria-label="Go back to trending">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    <span>Back to Trending</span>
                </button>
            </div>
        </form>
        {% if not compact_view and not tmdb_api_key_set %}
        <div class="tmdb-info">
            <p>To load movie and TV show posters, please set your TMDB API key in the settings.</p>
        </div>
        {% endif %}
        <div class="trending-container" id="trendingContainer">
            <div class="trending-movies">
                <div class="trending-header">
                    <h2 class="trending-title">Trending Movies</h2>
                    <div class="trending-navigation">
                        <button id="scrollLeft_mv" class="trending-nav-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        </button>
                        <button id="scrollRight_mv" class="trending-nav-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                    </div>
                </div>
                <div class="movie-list">
                    <div class="scroll-container" id="movieContainer"></div>
                </div>
            </div>
            <div class="trending-shows">
                <div class="trending-header">
                    <h2 class="trending-title">Trending Shows</h2>
                    <div class="trending-navigation">
                        <button id="scrollLeft_tv" class="trending-nav-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        </button>
                        <button id="scrollRight_tv" class="trending-nav-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                    </div>
                </div>
                <div class="show-list">
                    <div class="scroll-container" id="showContainer"></div>
                </div>
            </div>
            <div class="trending-anime">
                <div class="trending-header">
                    <h2 class="trending-title">Trending Anime</h2>
                    <div class="trending-navigation">
                        <button id="scrollLeft_anime" class="trending-nav-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        </button>
                        <button id="scrollRight_anime" class="trending-nav-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                    </div>
                </div>
                <div class="anime-list">
                    <div class="scroll-container" id="animeContainer"></div>
                </div>
            </div>
        </div>
        <div id="seasonResults" style="display: none;">
            <div id="season-info"></div>
            <div class="season-controls">
                <select id="seasonDropdown"></select>
                <button id="seasonPackButton">Season Pack</button>
                <button id="requestSeasonButton">Request Season</button>
            </div>
            <div id="episodeResults"></div>
        </div>
        <div id="overlay" class="overlay">
            <div class="overlay-content">                
                <button class="close-btn" aria-label="Close">&times;</button>
                <div id="overlayContent"></div>
            </div>
        </div>
        <div id="searchResult"></div>
        <!-- Add this div for search results -->
        <div id="searchResults" style="display: none;">
            <div class="search-results-container">
                <div class="search-results-header">
                    <h2 class="search-results-title">Search Results</h2>
                </div>
                <div id="resultsList" class="search-results-grid"></div>
            </div>
        </div>

        <!-- Version Selection Modal -->
        <div id="versionModal" class="version-modal">
            <div class="version-modal-content">
                <h3>Select Versions</h3>
                <div id="versionCheckboxes">
                    <!-- Version checkboxes will be dynamically inserted here -->
                </div>
                <div class="version-modal-buttons">
                    <button id="confirmVersions">Request</button>
                    <button id="cancelVersions">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Scrape Version Selection Modal -->
        <div id="scrapeVersionModal" class="version-modal">
            <div class="version-modal-content">
                <h3>Select Scrape Version</h3>
                <div id="scrapeVersionRadios">
                    <!-- Version radio buttons will be dynamically inserted here -->
                </div>
                <div class="version-modal-buttons">
                    <button id="confirmScrapeVersion">Scrape</button>
                    <button id="cancelScrapeVersion">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/loading.js') }}"></script>
    <script src="{{ url_for('static', filename='js/scraper.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/notifications.js') }}"></script>
{% endblock %}
